(function () {
  'use strict';

  let img = document.getElementById("sun");
  let canvas = document.getElementById("canvas");
  let context = canvas.getContext("2d");
  let pixels;
  let imgW = img.width, imgH = img.height;

  function invertToBW() {
    let p = pixels.data;
    for (let j = 0; j < p.length; j += 4) {
      if (
        (p[j] +
          p[j + 1] +
          p[j + 2]) / 2 > 255 / 2
      ) {
        p[j] = 255;
        p[j + 1] = 255;
        p[j + 2] = 255;
      } else {
        p[j] = 0;
        p[j + 1] = 0;
        p[j + 2] = 0;
      }
      p[j + 3] = 255;
    }
  }


  //context.putImageData(pixels, 0, 0);
  function getSDF() {
    let p = pixels.data;
    let par = [];
    let pp = [];
    let i, j;
    for (i = 0, j = 0; i < p.length; i += 4) {
      if (i % (imgW * 4) == 0 && i != 0) {
        if (pp.length == 0)
          continue;
        par = par.concat([pp]);
        pp = [];
        j = 0;
      }
      if (p[i] == 255)
        continue;
      if (p[i] == 0) {
        pp[j] = [0, i % imgW];
        j++;
      }
    }

    let s;
    for (j = 25; j < par.length; j++) {
      pp = par[j];
      i = 0;
      while (pp.length > 1) {
        if (i == pp.length - 1)
          break;
        s = ((pp[i][1] * pp[i][1] * 2 - (pp[i + 1][1] * pp[i + 1][1] * 2)) / (2 * pp[i][1] - 2 * pp[i + 1][1]));
        //console.log(`s${s}, ${pp[i][1]}`);
        if (pp[i][1] < s) {
          pp[i][0] = s;
          i++;
        }

        else {
          pp = pp.remove(pp[i]);
          i--;
        }
      }
    }
    
    let k = 0;
    for (i = 0, j = 0; i < p.length; i += 4) {
      if (i % imgW == 0 && i != 0)
        k++;
      if (par[k].length > j + 1 && par[k][j][0] < i)
        j++;
      console.log(par[k][j], i);
      let r = par[k][j][0] - i;
      let r2 = (r * r / 3); 
      p[i] = r2, p[i + 1] = r2, p[i + 2] = r2;
    }
  }

  window.addEventListener("load", () => {
    canvas.width = imgW * 2;
    canvas.height = imgH;

    context.drawImage(img, 0, 0);
    pixels = context.getImageData(0, 0, imgW, imgH);
    invertToBW();

    context.putImageData(pixels, 0, 0);

    getSDF();
    context.putImageData(pixels, 0, 0); 
  });

})();
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoibWFpbi5qcyIsInNvdXJjZXMiOlsiLi4vbWFpbi5qcyJdLCJzb3VyY2VzQ29udGVudCI6WyJsZXQgaW1nID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoXCJzdW5cIik7XHJcbmxldCBjYW52YXMgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZChcImNhbnZhc1wiKTtcclxubGV0IGNvbnRleHQgPSBjYW52YXMuZ2V0Q29udGV4dChcIjJkXCIpO1xyXG5sZXQgcGl4ZWxzO1xyXG5sZXQgaW1nVyA9IGltZy53aWR0aCwgaW1nSCA9IGltZy5oZWlnaHQ7XHJcblxyXG5mdW5jdGlvbiBpbnZlcnRUb0JXKCkge1xyXG4gIGxldCBwID0gcGl4ZWxzLmRhdGE7XHJcbiAgZm9yIChsZXQgaiA9IDA7IGogPCBwLmxlbmd0aDsgaiArPSA0KSB7XHJcbiAgICBpZiAoXHJcbiAgICAgIChwW2pdICtcclxuICAgICAgICBwW2ogKyAxXSArXHJcbiAgICAgICAgcFtqICsgMl0pIC8gMiA+IDI1NSAvIDJcclxuICAgICkge1xyXG4gICAgICBwW2pdID0gMjU1O1xyXG4gICAgICBwW2ogKyAxXSA9IDI1NTtcclxuICAgICAgcFtqICsgMl0gPSAyNTU7XHJcbiAgICB9IGVsc2Uge1xyXG4gICAgICBwW2pdID0gMDtcclxuICAgICAgcFtqICsgMV0gPSAwO1xyXG4gICAgICBwW2ogKyAyXSA9IDA7XHJcbiAgICB9XHJcbiAgICBwW2ogKyAzXSA9IDI1NTtcclxuICB9XHJcbn1cclxuXHJcblxyXG4vL2NvbnRleHQucHV0SW1hZ2VEYXRhKHBpeGVscywgMCwgMCk7XHJcbmZ1bmN0aW9uIGdldFNERigpIHtcclxuICBsZXQgcCA9IHBpeGVscy5kYXRhO1xyXG4gIGxldCBwYXIgPSBbXTtcclxuICBsZXQgcHAgPSBbXTtcclxuICBsZXQgaSwgajtcclxuICBmb3IgKGkgPSAwLCBqID0gMDsgaSA8IHAubGVuZ3RoOyBpICs9IDQpIHtcclxuICAgIGlmIChpICUgKGltZ1cgKiA0KSA9PSAwICYmIGkgIT0gMCkge1xyXG4gICAgICBpZiAocHAubGVuZ3RoID09IDApXHJcbiAgICAgICAgY29udGludWU7XHJcbiAgICAgIHBhciA9IHBhci5jb25jYXQoW3BwXSk7XHJcbiAgICAgIHBwID0gW107XHJcbiAgICAgIGogPSAwO1xyXG4gICAgfVxyXG4gICAgaWYgKHBbaV0gPT0gMjU1KVxyXG4gICAgICBjb250aW51ZTtcclxuICAgIGlmIChwW2ldID09IDApIHtcclxuICAgICAgcHBbal0gPSBbMCwgaSAlIGltZ1ddO1xyXG4gICAgICBqKys7XHJcbiAgICB9XHJcbiAgfVxyXG5cclxuICBsZXQgcztcclxuICBmb3IgKGogPSAyNTsgaiA8IHBhci5sZW5ndGg7IGorKykge1xyXG4gICAgcHAgPSBwYXJbal07XHJcbiAgICBpID0gMDtcclxuICAgIHdoaWxlIChwcC5sZW5ndGggPiAxKSB7XHJcbiAgICAgIGlmIChpID09IHBwLmxlbmd0aCAtIDEpXHJcbiAgICAgICAgYnJlYWs7XHJcbiAgICAgIHMgPSAoKHBwW2ldWzFdICogcHBbaV1bMV0gKiAyIC0gKHBwW2kgKyAxXVsxXSAqIHBwW2kgKyAxXVsxXSAqIDIpKSAvICgyICogcHBbaV1bMV0gLSAyICogcHBbaSArIDFdWzFdKSk7XHJcbiAgICAgIC8vY29uc29sZS5sb2coYHMke3N9LCAke3BwW2ldWzFdfWApO1xyXG4gICAgICBpZiAocHBbaV1bMV0gPCBzKSB7XHJcbiAgICAgICAgcHBbaV1bMF0gPSBzO1xyXG4gICAgICAgIGkrKztcclxuICAgICAgfVxyXG5cclxuICAgICAgZWxzZSB7XHJcbiAgICAgICAgcHAgPSBwcC5yZW1vdmUocHBbaV0pO1xyXG4gICAgICAgIGktLTtcclxuICAgICAgfVxyXG4gICAgfVxyXG4gIH1cclxuICBcclxuICBsZXQgayA9IDA7XHJcbiAgZm9yIChpID0gMCwgaiA9IDA7IGkgPCBwLmxlbmd0aDsgaSArPSA0KSB7XHJcbiAgICBpZiAoaSAlIGltZ1cgPT0gMCAmJiBpICE9IDApXHJcbiAgICAgIGsrKztcclxuICAgIGlmIChwYXJba10ubGVuZ3RoID4gaiArIDEgJiYgcGFyW2tdW2pdWzBdIDwgaSlcclxuICAgICAgaisrO1xyXG4gICAgY29uc29sZS5sb2cocGFyW2tdW2pdLCBpKTtcclxuICAgIGxldCByID0gcGFyW2tdW2pdWzBdIC0gaTtcclxuICAgIGxldCByMiA9IChyICogciAvIDMpOyBcclxuICAgIHBbaV0gPSByMiwgcFtpICsgMV0gPSByMiwgcFtpICsgMl0gPSByMjtcclxuICB9XHJcbn1cclxuXHJcbndpbmRvdy5hZGRFdmVudExpc3RlbmVyKFwibG9hZFwiLCAoKSA9PiB7XHJcbiAgY2FudmFzLndpZHRoID0gaW1nVyAqIDI7XHJcbiAgY2FudmFzLmhlaWdodCA9IGltZ0g7XHJcblxyXG4gIGNvbnRleHQuZHJhd0ltYWdlKGltZywgMCwgMCk7XHJcbiAgcGl4ZWxzID0gY29udGV4dC5nZXRJbWFnZURhdGEoMCwgMCwgaW1nVywgaW1nSCk7XHJcbiAgaW52ZXJ0VG9CVygpO1xyXG5cclxuICBjb250ZXh0LnB1dEltYWdlRGF0YShwaXhlbHMsIDAsIDApO1xyXG5cclxuICBnZXRTREYoKTtcclxuICBjb250ZXh0LnB1dEltYWdlRGF0YShwaXhlbHMsIDAsIDApOyBcclxufSk7Il0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiI7OztFQUFBLElBQUksR0FBRyxHQUFHLFFBQVEsQ0FBQyxjQUFjLENBQUMsS0FBSyxDQUFDLENBQUM7RUFDekMsSUFBSSxNQUFNLEdBQUcsUUFBUSxDQUFDLGNBQWMsQ0FBQyxRQUFRLENBQUMsQ0FBQztFQUMvQyxJQUFJLE9BQU8sR0FBRyxNQUFNLENBQUMsVUFBVSxDQUFDLElBQUksQ0FBQyxDQUFDO0VBQ3RDLElBQUksTUFBTSxDQUFDO0VBQ1gsSUFBSSxJQUFJLEdBQUcsR0FBRyxDQUFDLEtBQUssRUFBRSxJQUFJLEdBQUcsR0FBRyxDQUFDLE1BQU0sQ0FBQztBQUN4QztFQUNBLFNBQVMsVUFBVSxHQUFHO0VBQ3RCLEVBQUUsSUFBSSxDQUFDLEdBQUcsTUFBTSxDQUFD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
